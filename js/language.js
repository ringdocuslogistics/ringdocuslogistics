// Полный словарь переводов
const translations = {
    en: {

        // Header
        "home": "Home",
        "services": "Services",
        "about": "About Us",
        "career": "Career",
        "contact": "Contact Us",
        
        // Hero
        "welcome": "Welcome to Ringdocus Logistics – Your Trusted Partner in Trucking Excellence!",
        "slogan": "Bringing your goods the safest way!",
        "cta": "Get A Quote",
        
        // Section 1 Left
        "why-choose": "Why Choose Ringdocus Logistics?",
        "why-desc": "At Ringdocus Logistics, we deliver more than just freight—we deliver reliability, efficiency, and peace of mind. As a premier trucking company in the U.S., we specialize in timely, safe, and cost-effective transportation solutions tailored to meet your business needs.",

        // Section 1 Right
        "cargosafe": "Your cargo is safe with us!",
        "1-feature1": "Nationwide Coverage – From coast to coast, we’ve got you covered.",
        "1-feature2": "Dedicated Fleet – Modern, well-maintained trucks for secure deliveries.",
        "1-feature3": "Experienced Team – Professional drivers and logistics experts you can trust.",
        "1-feature4": "Custom Solutions – Full truckload (FTL), less-than-truckload (LTL), and expedited shipping.",
        "1-feature5": "24/7 Support – Real-time tracking and customer service when you need it.",
        
        // Section 2 Left
        "": "",

        // Section 2 Right
        "2-feature1": "Whether you're shipping retail goods, industrial equipment, or specialized cargo, Ringdocus Logistics ensures your freight arrives on time, every time. Get a Free Quote or Call Us Today! Let’s move your business forward — efficiently, safely, and reliably.",
        "phone": "+1-406-967-23-18",
        "": "",

        // Section 3
        "our-location": "Our Location",
        "location-desc": "We are conveniently located to serve all your logistics needs. Visit us or get in touch for more information about our services.",
        "address-title": "Ringdocus Logistics HQ",
        "address-street": "Mullan Road",
        "address-city": "Missoula, MT 2965",
        "address-phone": "+1-406-967-23-18",
        "": "",

        // Error
        "error-h1": "<i class='fa fa-exclamation-triangle fa-lg  fa-spin' style='color:#ff0606'></i>   This is an error!",
        "error-p": "Page is not found. What a shame.",

        // Footer
        "footer-whoarewe": "Who Are We",
        "footer-media": "Media",
        "footer-aboutus": "About Us",
        "footer-contact": "Contact Us",
        "footer-gallery": "Our Gallery",
        "footer-partners": "Our partners",
        "copyright": "All rights reserved. No part of this publication may be reproduced, distributed, or transmitted in any form or by any means, including photocopying, recording, or other electronic or mechanical methods, without the prior written permission of the publisher, except in the case of brief quotations embodied in critical reviews and certain other noncommercial uses permitted by copyright law. For permission requests, please contact the publisher at ringdocuslogistics@gmail.com.",
        //About Us Section
        "about-title": "About Ringdocus Logistics",
        "about-text1": "At Ringdocus Logistics, we are more than just a trucking company—we are a committed partner in your supply chain success. Founded with a mission to provide reliable, efficient, and customer-focused transportation solutions, we have built a reputation for excellence in the U.S. logistics industry.",
        "about-text2": "With years of experience, a modern fleet, and a team of skilled professionals, we ensure that every shipment is handled with the utmost care and precision. Our commitment to safety, punctuality, and transparency sets us apart, making us the preferred choice for businesses that demand dependable freight services.",
    
        "pride-title": "We pride ourselves on:",
        "pride-item1": "Integrity & Accountability – Honest communication and dependable service.",
        "pride-item2": "Cutting-Edge Technology – Advanced tracking and logistics management.",
        "pride-item3": "Sustainable Practices – Fuel-efficient routing and eco-conscious operations.",
        "pride-item4": "Customer-Centric Approach – Tailored solutions for your unique needs.",
        "pride-text": "From small businesses to large enterprises, Ringdocus Logistics is your trusted partner for seamless, stress-free shipping.",
        "career-hero-title": "Drive Your Career Forward",
        "career-hero-text": "Join our team of professional drivers and logistics experts. We offer competitive pay, great benefits, and a supportive work environment.",
        "apply-now": "Apply Now",
        "why-join": "Why Join Ringdocus Logistics?",
        "competitive-pay": "Competitive Pay",
        "pay-desc": "Top industry rates with regular bonuses",
        "health-benefits": "Health Benefits",
        "health-desc": "Comprehensive medical, dental, vision",
        "modern-equipment": "Modern Equipment",
        "equipment-desc": "New, well-maintained trucks",
        "home-time": "Regular Home Time",
        "home-desc": "Work-life balance matters",
        "open-positions": "Open Positions",
        "position-otr": "Over-the-Road Driver",
        "location-nationwide": "Nationwide",
        "requirements": "Requirements",
        "req1": "Valid CDL Class A",
        "req2": "2+ years experience",
        "req3": "Clean driving record",
        "responsibilities": "Responsibilities",
        "resp1": "Long-haul freight transport",
        "resp2": "Pre-trip inspections",
        "resp3": "Timely deliveries",
        "position-logistician": "Logistics Coordinator",
        "position-manager": "Operations Manager",
        "position-mechanic": "Truck Mechanic",
        "location-missoula": "Missoula, MT",
        "log-req1": "Degree in Logistics or 3+ years experience",
        "log-req2": "Knowledge of transportation management systems",
        "log-req3": "Strong analytical skills",
        "log-resp1": "Route planning and optimization",
        "log-resp2": "Communication with drivers/clients",
        "log-resp3": "Freight tracking and reporting",
        "man-req1": "5+ years in logistics management",
        "man-req2": "Leadership and team coordination",
        "man-req3": "Budget and resource planning",
        "man-resp1": "Oversee daily operations",
        "man-resp2": "Improve efficiency and reduce costs",
        "man-resp3": "Client and vendor negotiations",
        "mec-req1": "Certification in diesel mechanics",
        "mec-req2": "Experience with heavy trucks",
        "mec-req3": "Diagnostic and repair skills",
        "mec-resp1": "Preventive maintenance",
        "mec-resp2": "Engine and brake system repairs",
        "mec-resp3": "Fleet readiness inspections",

        "contact-title": "Contact Us",
        "contact-description": "We’d love to hear from you! Contact us through any of the following methods.",
        "address-title": "Headquarters",
        "address-street": "Mullan Road",
        "address-city": "Missoula, MT 2965",
        "address-phone": "Phone",
        "quote-title": "Request a Free Quote",
        "quote-desc": "Let us help you move smarter. Fill in the form and get a custom estimate.",
        "quote-name": "Your Name",
        "quote-email": "Email",
        "quote-phone": "Phone Number",
        "quote-details": "Describe Your Shipment",
        "quote-submit": "Submit"
    },
    ru: {
         // Header
        "home": "Главная",
        "services": "Услуги",
        "about": "О нас",
        "career": "Работа",
        "contact": "Контакты",
        
        // Hero
        "welcome": "Добро пожаловать в Ringdocus Logistics — вашего надежного партнера в сфере грузоперевозок высочайшего качества!",
        "slogan": "Доставьте ваши товары самым безопасным способом!",
        "cta": "Запрос Цены",
        
        // Section 1 Left
        "why-choose": "Почему стоит выбрать Ringdocus Logistics?",
        "why-desc": "В Ringdocus Logistics мы доставляем больше, чем просто грузы — мы доставляем надежность, эффективность и душевное спокойствие. Как ведущая транспортная компания в США, мы специализируемся на своевременных, безопасных и экономически эффективных транспортных решениях, разработанных с учетом потребностей вашего бизнеса.",

        // Section 1 Right
        "cargosafe": "С нами ваш груз в безопасности!",
        "1-feature1": "Покрытие по всей стране — мы обеспечим вам страховку от побережья до побережья.",
        "1-feature2": "Специализированный автопарк — современные, хорошо обслуживаемые грузовики для безопасных доставок.",
        "1-feature3": "Опытная команда — профессиональные водители и эксперты по логистике, которым вы можете доверять.",
        "1-feature4": "Индивидуальные решения — полная загрузка грузовика (FTL), частичная загрузка грузовика (LTL) и ускоренная доставка.",
        "1-feature5": "Круглосуточная поддержка — отслеживание в режиме реального времени и обслуживание клиентов, когда вам это необходимо (Есть поддержка на русском языке!).",
        
        // Section 2 Left
        "": "",

        // Section 2 Right
        "2-feature1": "Независимо от того, перевозите ли вы розничные товары, промышленное оборудование или специализированные грузы, Ringdocus Logistics гарантирует, что ваш груз будет доставлен вовремя, каждый раз. Получите бесплатную смету или позвоните нам сегодня! Давайте продвинем ваш бизнес вперед — эффективно, безопасно и надежно.",
        "phone": "+1-406-967-23-18", 
        // +7-899-302-90-00
        "": "",

         // Section 3
        "our-location": "Наше местоположение",
        "location-desc": "Мы удобно расположены, чтобы удовлетворить все ваши логистические потребности. Посетите нас или свяжитесь с нами для получения дополнительной информации о наших услугах.",
        "address-title": "Главный офис Ringdocus Logistics",
        "address-street": "Mullan Road",
        "address-city": "Missoula, MT 2965",
        "address-phone": "+1-406-967-23-18",
        "": "",

        // Error
        "error-h1": "<i class='fa fa-exclamation-triangle fa-lg fa-spin' style='color:#ff0606'></i> Это ошибка!",
        "error-p": "Страница не найдена. Печаль :(",

        // Footer
        "footer-whoarewe": "Кто Мы",
        "footer-media": "Медиа",
        "footer-aboutus": "О нас",
        "footer-contact": "Контакты",
        "footer-gallery": "Галерея",
        "footer-partners": "Наши партнеры",
        "copyright": "Все права защищены. Никакая часть этой публикации не может быть воспроизведена, распространена или передана в любой форме или любыми средствами, включая фотокопирование, запись или другие электронные или механические методы, без предварительного письменного разрешения издателя, за исключением случаев кратких цитат, включенных в критические обзоры, и некоторых других некоммерческих видов использования, разрешенных законом об авторском праве. Для запросов на разрешение, пожалуйста, свяжитесь с издателем по адресу ringdocuslogistics@gmail.com.",
        // About Us Section
        "about-title": "О компании Ringdocus Logistics",
        "about-text1": "В Ringdocus Logistics мы больше, чем просто транспортная компания — мы надежный партнер в успехе вашей цепочки поставок. Основанная с миссией предоставления надежных, эффективных и ориентированных на клиента транспортных решений, мы зарекомендовали себя как лидер в логистической отрасли США.",
        "about-text2": "Благодаря многолетнему опыту, современному автопарку и команде квалифицированных специалистов мы гарантируем, что каждый груз обрабатывается с максимальной заботой и точностью. Наша приверженность безопасности, пунктуальности и прозрачности выделяет нас, делая предпочтительным выбором для бизнесов, требующих надежных грузоперевозок.",
    
        "pride-title": "Мы гордимся:",
        "pride-item1": "Честностью и ответственностью — открытое общение и надежный сервис.",
        "pride-item2": "Современными технологиями — передовые системы отслеживания и управления логистикой.",
        "pride-item3": "Экологичными практиками — экономичные маршруты и экологически сознательные операции.",
        "pride-item4": "Клиентоориентированным подходом — индивидуальные решения для ваших уникальных потребностей.",
        "pride-text": "От малого бизнеса до крупных предприятий — Ringdocus Logistics ваш надежный партнер для бесперебойных и беззаботных перевозок.",
        "career-hero-title": "Развивайте свою карьеру",
        "career-hero-text": "Присоединяйтесь к нашей команде профессиональных водителей и логистов. Мы предлагаем конкурентоспособную зарплату, отличные льготы и поддерживающую рабочую атмосферу.",
        "apply-now": "Подать заявку",
        "why-join": "Почему стоит присоединиться?",
        "competitive-pay": "Конкурентоспособная зарплата",
        "pay-desc": "Высокие ставки в отрасли с регулярными бонусами",
        "health-benefits": "Медицинская страховка",
        "health-desc": "Полный медицинский, стоматологический пакет",
        "modern-equipment": "Современная техника",
        "equipment-desc": "Новые, хорошо обслуживаемые грузовики",
        "home-time": "Регулярное время дома",
        "home-desc": "Баланс работы и личной жизни",
        "open-positions": "Открытые вакансии",
        "position-otr": "Дальнобойщик",
        "location-nationwide": "По всей стране",
        "requirements": "Требования",
        "req1": "Действующие права категории CDL A",
        "req2": "Опыт работы от 2 лет",
        "req3": "Чистая история вождения",
        "responsibilities": "Обязанности",
        "resp1": "Перевозка грузов на дальние расстояния",
        "resp2": "Предрейсовый осмотр",
        "resp3": "Своевременные доставки",
        "position-logistician": "Логист",
        "position-manager": "Менеджер операций",
        "position-mechanic": "Механик грузовиков",
        "location-missoula": "Мизула, Монтана",
        "log-req1": "Образование в логистике или 3+ года опыта",
        "log-req2": "Знание систем управления перевозками",
        "log-req3": "Аналитические навыки",
        "log-resp1": "Планирование и оптимизация маршрутов",
        "log-resp2": "Общение с водителями/клиентами",
        "log-resp3": "Отслеживание грузов и отчетность",
        "man-req1": "5+ лет в управлении логистикой",
        "man-req2": "Лидерские качества и координация команды",
        "man-req3": "Планирование бюджета и ресурсов",
        "man-resp1": "Контроль ежедневных операций",
        "man-resp2": "Улучшение эффективности и снижение затрат",
        "man-resp3": "Переговоры с клиентами и поставщиками",
        "mec-req1": "Сертификация по дизельным двигателям",
        "mec-req2": "Опыт работы с тяжелой техникой",
        "mec-req3": "Навыки диагностики и ремонта",
        "mec-resp1": "Профилактическое обслуживание",
        "mec-resp2": "Ремонт двигателей и тормозных систем",
        "mec-resp3": "Инспекция готовности автопарка",

          "contact-title": "Свяжитесь с нами",
        "contact-description": "Будем рады вам помочь! Свяжитесь с нами любым удобным способом.",
        "address-title": "Штаб-квартира",
        "address-street": "Улица Муллан",
        "address-city": "Миссула, Монтана 2965",
        "address-phone": "Телефон",
        "quote-title": "Получить предложение",
        "quote-desc": "Заполните форму, и мы рассчитаем цену под ваш запрос.",
        "quote-name": "Ваше имя",
        "quote-email": "Электронная почта",
        "quote-phone": "Номер телефона",
        "quote-details": "Опишите ваш груз",
        "quote-submit": "Отправить"
    },
    il: {
         // Header
        "home": "בַּיִת",
        "services": "שירותים",
        "about": "אוֹדוֹת",
        "career": "קריירה",
        "contact": "מַגָע",
        
        // Hero
        "welcome": "ברוכים הבאים ל-Ringdocus Logistics - השותף האמין שלך להובלת מטענים באיכות הגבוהה ביותר!",
        "slogan": "אספקת הסחורה שלך בצורה הבטוחה ביותר!",
        "cta": "בקש מחירים",
        
        // Section 1 Left
        "why-choose": "למה לבחור ב- Ringdocus Logistics?",
        "why-desc": "ב-Ringdocus Logistics, אנו מספקים יותר מסתם מטען - אנו מספקים אמינות, יעילות ושקט נפשי. כחברת הסעות מובילה בארצות הברית, אנו מתמחים בפתרונות הובלה בזמן, בטוחים וחסכוניים המיועדים לענות על צרכי העסק שלך.",

        // Section 1 Right
        "cargosafe": "אצלנו המטען שלך בטוח!",
        "1-feature1": "כיסוי ארצי - דאגנו לכם מחוף לחוף.",
        "1-feature2": "צי ייעודי של משאיות מודרניות ומתוחזקות היטב למשלוחים בטוחים.",
        "1-feature3": "צוות מנוסה - נהגים מקצועיים ומומחי לוגיסטיקה שניתן לסמוך עליהם.",
        "1-feature4": "פתרונות מותאמים אישית - עומס משאית מלא (FTL), פחות מעומס משאית (LTL) ואספקה ​​מהירה.",
        "1-feature5": "תמיכה 24/7 - מעקב בזמן אמת ושירות לקוחות בכל עת שתצטרכו (תמיכה בעברית זמינה!).",
        
        // Section 2 Left
        "": "",

        // Section 2 Right
        "2-feature1": "בין אם אתה מוביל סחורות קמעונאיות, ציוד תעשייתי או מטענים מיוחדים, Ringdocus Logistics מבטיחה שהמשלוח שלך יגיע בזמן, בכל פעם. קבל הערכה חינם או התקשר אלינו עוד היום! תנו לנו לקדם את העסק שלכם - ביעילות, בטוחה ובטוחה.",
        "phone": "+1-406-967-23-18", 
        // +7-899-302-90-00
        "": "",

         // Section 3
        "our-location": "המיקום שלנו",
        "location-desc": "אנחנו ממוקמים בנוחות כדי לענות על כל הצרכים הלוגיסטיים שלך. בקרו אותנו או פנו אלינו למידע נוסף על השירותים שלנו.",
        "address-title": "משרד ראשי לוגיסטיקה של רינגדוקוס",
        "address-street": "Mullan Road",
        "address-city": "Missoula, MT 2965",
        "address-phone": "+1-406-967-23-18",
        "": "",

        // Error
        "error-h1": "<i class='fa fa-exclamation-triangle fa-lg fa-spin' style='color:#ff0606'></i> זו טעות!",
        "error-p": "הדף לא נמצא. עצב :(",

        // Footer
        "footer-whoarewe": "מי אנחנו",
        "footer-media": "כְּלֵי תִקְשׁוֹרֶת",
        "footer-aboutus": "אודותינו",
        "footer-contact": "אנשי קשר",
        "footer-gallery": "גָלֶרֵיָה",
        "footer-partners": "השותפים שלנו",
        "copyright": "כֹּל הַזְכוּיוֹת שְׁמוּרוֹת. אין לשכפל, להפיץ או להעביר כל חלק מפרסום זה בכל צורה או אמצעי שהוא, לרבות צילום, הקלטה או שיטות אלקטרוניות או מכניות אחרות, ללא אישור מראש ובכתב מהמוציא לאור, למעט במקרה של ציטוטים קצרים המשולבים בסקירות ביקורתיות ושימושים לא מסחריים מסוימים אחרים המותרים על פי חוק זכויות יוצרים. לבקשות אישור, אנא צרו קשר עם המוציא לאור בכתובת ringdocuslogistics@gmail.com.",
        // About Us Section
        "about-title": "אודות Ringdocus Logistics",
        "about-text1": "ב-Ringdocus Logistics, אנחנו יותר מחברת הובלות - אנחנו שותף מחויב להצלחת שרשרת האספקה שלך. נוסדנו עם משימה לספק פתרונות תחבורה אמינים, יעילים וממוקדי לקוח, ובנינו מוניטין של מצוינות בתעשיית הלוגיסטיקה בארה\"ב.",
        "about-text2": "עם שנים של ניסיון, צי מודרני וצוות של אנשי מקצוע מיומנים, אנו מבטיחים שכל משלוח מטופל בזהירות ובדיוק מרבי. המחויבות שלנו לבטיחות, לדייקנות ולשקיפות מבדילה אותנו, והופכת אותנו לבחירה המועדפת עבור עסקים הדורשים שירותי הובלה אמינים.",
    
        "pride-title": "אנו גאים ב:",
        "pride-item1": "יושרה ואחריות - תקשורת כנה ושירות אמין.",
        "pride-item2": "טכנולוגיה מתקדמת - מערכות מעקב וניהול לוגיסטי מתקדמות.",
        "pride-item3": "פרקטיקות ברות קיימא - מסלולים חסכוניים בדלק ופעולות ידידותיות לסביבה.",
        "pride-item4": "גישה ממוקדת לקוח - פתרונות מותאמים אישית לצרכים הייחודיים שלך.",
        "pride-text": "מעסקים קטנים ועד ארגונים גדולים, Ringdocus Logistics הוא השותף האמין שלך למשלוחים חלקים וללא מתח.",
        "career-hero-title": "הצע קדימה את הקריירה שלך",
        "career-hero-text": "הצטרף לצוות הנהגים המקצועיים ומומחי הלוגיסטיקה שלנו. אנו מציעים שכר תחרותי, הטבות מעולות וסביבת עבודה תומכת.",
        "apply-now": "הגש מועמדות עכשיו",
        "why-join": "למה להצטרף ל-Ringdocus Logistics?",
        "competitive-pay": "שכר תחרותי",
        "pay-desc": "שיעורי תעשייה מובילים עם בונוסים קבועים",
        "health-benefits": "הטבות בריאות",
        "health-desc": "רפואה מקיפה, שיניים, ראייה",
        "modern-equipment": "ציוד מודרני",
        "equipment-desc": "משאיות חדשות ומתוחזקות היטב",
        "home-time": "זמן בית קבוע",
        "home-desc": "איזון עבודה-חיים חשוב",
        "open-positions": "משרות פנויות",
        "position-otr": "נהג למרחקים ארוכים",
        "location-nationwide": "ארצי",
        "requirements": "דרישות",
        "req1": "רישיון נהיגה CDL Class A תקף",
        "req2": "ניסיון של 2+ שנים",
        "req3": "היסטוריית נהיגה נקייה",
        "responsibilities": "אחריות",
        "resp1": "הובלת מטען למרחקים ארוכים",
        "resp2": "בדיקות טרום נסיעה",
        "resp3": "משלוחים בזמן",
        "position-logistician": "רכז לוגיסטיקה",
        "position-manager": "מנהל פעולות",
        "position-mechanic": "מוכַּנַאי משאיות",
        "location-missoula": "מיזולה, מונטנה",
        "log-req1": "תואר בלוגיסטיקה או 3+ שנות ניסיון",
        "log-req2": "ידע במערכות ניהול הובלות",
        "log-req3": "כישורים אנליטיים",
        "log-resp1": "תכנון ומיטוב מסלולים",
        "log-resp2": "תקשורת עם נהגים/לקוחות",
        "log-resp3": "מעקב מטען ודיווח",
        "man-req1": "5+ שנות ניסיון בניהול לוגיסטיקה",
        "man-req2": "מנהיגות ותיאום צוות",
        "man-req3": "תכנון תקציב ומשאבים",
        "man-resp1": "פיקוח על פעולות יומיומיות",
        "man-resp2": "שיפור יעילות והורדת עלויות",
        "man-resp3": "משא ומתן עם לקוחות וספקים",
        "mec-req1": "הסמכה במכניקת דיזל",
        "mec-req2": "ניסיון עם משאיות כבדות",
        "mec-req3": "כישורי אבחון ותיקון",
        "mec-resp1": "תחזוקה מונעת",
        "mec-resp2": "תיקון מנועים ומערכות בלמים",
        "mec-resp3": "בדיקות מוכנות צי",

        "contact-title": "צור קשר",
        "contact-description": "נשמח לשמוע ממך! תוכל ליצור איתנו קשר באחת מהדרכים הבאות.",
        "address-title": "המטה הראשי",
        "address-street": "רחוב מולן",
        "address-city": "מיסולה, מונטנה 2965",
        "address-phone": "טלפון",

  "quote-title": "בקשת הצעת מחיר",
  "quote-desc": "מלא את הטופס וקבל הצעת מחיר מותאמת אישית.",
  "quote-name": "שמך",
  "quote-email": "אימייל",
  "quote-phone": "מספר טלפון",
  "quote-details": "תאר את המשלוח שלך",
  "quote-submit": "שלח"
    }
};

const languages = {
    en: {
        name: "English",
        flag: "🇺🇸"
    },
    ru: {
        name: "Русский",
        flag: "🇷🇺"
    },
    il: {
        name: " עִברִית",
        flag: "🇮🇱"
    }
};

// 1. Анимация смены языка
function playLanguageSwitchAnimation() {
    return new Promise((resolve) => {
        const body = document.body;
        body.classList.add('language-transition', 'active');
        
        // Безопасная проверка элемента top-image-text
        const topImageText = document.getElementById('top-image-text');
        if (topImageText) {
            topImageText.style.opacity = '0';
        }
        
        setTimeout(() => {
            body.classList.remove('active');
            if (topImageText) {
                topImageText.style.opacity = '1';
            }
            resolve();
        }, 400);
    });
}

// 2. Определение языка по IP (с обработкой ошибок)
async function detectLanguageByIP() {
    try {
        const response = await fetch('https://ipapi.co/json/');
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        
        const russianSpeakingCountries = ['ru', 'by', 'kz', 'ua'];
        return russianSpeakingCountries.includes(data.country) ? 'ru' : 'en';
        
    } catch (error) {
        console.log('Не удалось определить по IP, используем язык браузера:', error);
        return navigator.language.slice(0, 2) === 'ru' ? 'ru' : 'en';
    }
}

// 3. Инициализация языка
async function initLanguage() {
    const savedLang = localStorage.getItem('siteLang');
    if (savedLang) return savedLang;
    
    try {
        const ipLang = await detectLanguageByIP();
        return ipLang || 'en';
    } catch (error) {
        return 'en'; // fallback
    }
}

// 4. Настройка выпадающего меню (с проверкой существования элементов)
function setupLanguageDropdown() {
    const dropdown = document.getElementById('language-dropdown');
    const toggle = document.getElementById('language-toggle');
    
    if (!dropdown || !toggle) return; // Если элементов нет, выходим
    
    toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdown.classList.toggle('active');
    });
    
    document.addEventListener('click', () => {
        dropdown.classList.remove('active');
    });
    
    const languageOptions = document.querySelectorAll('#language-options li');
    if (languageOptions.length > 0) {
        languageOptions.forEach(item => {
            item.addEventListener('click', async (e) => {
                e.stopPropagation();
                const lang = item.getAttribute('data-lang');
                
                item.classList.add('language-item-active');
                setTimeout(() => {
                    item.classList.remove('language-item-active');
                }, 400);
                
                await applyLanguage(lang);
                dropdown.classList.remove('active');
            });
        });
    }
}

// 5. Основная функция перевода (с защитой от ошибок)
async function applyLanguage(lang) {
    if (!translations[lang]) {
        console.error(`Language ${lang} not found in translations`);
        return;
    }

    // Устанавливаем направление текста
    document.documentElement.dir = lang === 'il' ? 'rtl' : 'ltr';
    
    // Добавляем класс для RTL (если нужно)
    if (lang === 'il') {
        document.body.classList.add('rtl');
    } else {
        document.body.classList.remove('rtl');
    }
    
    await playLanguageSwitchAnimation();
    
    localStorage.setItem('siteLang', lang);
    document.documentElement.lang = lang;
    
    // Обновляем кнопку, если она есть
    const currentLangElement = document.getElementById('current-language');
    if (currentLangElement) {
        currentLangElement.innerHTML = `${languages[lang].flag} ${lang.toUpperCase()}`;
    }
    
    // Применяем переводы ко всем найденным элементам
    Object.entries(translations[lang]).forEach(([key, text]) => {
        const elements = document.querySelectorAll(`[data-i18n="${key}"]`);
        if (elements.length > 0) {
            elements.forEach(el => {
                // Используем innerHTML вместо textContent для сохранения HTML-разметки
                el.innerHTML = text;
            });
        }
    });
}

/* ========= УНИВЕРСАЛЬНЫЙ ЗАПУСК СКРИПТА ========= */
document.addEventListener('DOMContentLoaded', async () => {
    try {
        // Проверяем, есть ли необходимые элементы для меню
        if (document.getElementById('language-dropdown')) {
            setupLanguageDropdown();
        }
        
        const lang = await initLanguage();
        await applyLanguage(lang);
    } catch (error) {
        console.error('Error initializing language:', error);
        // Применяем английский как fallback
        await applyLanguage('en');
    }
});

// Экспортируем функции для использования в других скриптах (если нужно)
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        translations,
        languages,
        applyLanguage,
        initLanguage
    };
}